#!/usr/bin/env python3

import multiprocessing
import os
import sys
import time


bind = "0.0.0.0:1024"
workers = multiprocessing.cpu_count() * 2
keepalive = 60
timeout = 600
accesslog = '-'
access_log_format = '%(t)s %(h)s "%(r)s" %(s)s %(b)s %(D)s "%(a)s"'


def _confirm_db():
    while True:
        try:
            from fsm_hub import core
            break
        except Exception as e:
            print(e, file=sys.stderr)
            time.sleep(1)


def on_starting(server):
    if os.fork():
        os.wait()
    else:
        _confirm_db()
        sys.exit(0)
